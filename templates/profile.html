{% extends "layout.html" %}
{% block content %}
<main class="mx-auto max-w-4xl py-6 sm:px-6 lg:px-8 space-y-8">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="flash-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="bg-white p-6 rounded-lg shadow-md">
        
        <div class="flex justify-between items-center mb-6 border-b pb-4">
            <h2 class="text-2xl font-bold text-gray-800">Edit My Profile</h2>
            <a href="{{ url_for('employee_dashboard') }}" class="btn-tertiary">
                &larr; Back to Dashboard
            </a>
        </div>

        <form action="{{ url_for('employee_profile') }}" method="POST" enctype="multipart/form-data" class="space-y-8">
            
            <div>
                <h3 class="text-lg font-medium text-gray-900">Personal Information</h3>
                <div class="mt-4 flex items-center space-x-6">
                    <img class="h-24 w-24 rounded-full object-cover" 
                         src="{{ url_for('avatar_file', filename=g.user.profile_picture) if g.user.profile_picture else 'https://ui-avatars.com/api/?name=' + g.user.name|replace(' ', '+') + '&background=0052cc&color=fff&bold=true' }}" 
                         alt="Current profile picture">
                    <div>
                        <label for="profile_pic" class="block text-sm font-medium text-gray-700">Change Profile Picture</label>
                        <input type="file" name="profile_pic" id="profile_pic" class="mt-1 text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                    <div><label class="form-label">Full Name (Read-only)</label><input type="text" value="{{ g.user.name }}" class="form-input bg-gray-100 cursor-not-allowed" readonly></div>
                    <div><label class="form-label">Email Address (Read-only)</label><input type="email" value="{{ g.user.email }}" class="form-input bg-gray-100 cursor-not-allowed" readonly></div>
                    <div><label for="phone_number" class="form-label">Mobile Number</label><input type="tel" name="phone_number" id="phone_number" class="form-input" value="{{ g.user.phone_number or '' }}"></div>
                    <div><label for="date_of_birth" class="form-label">Date of Birth</label><input type="date" name="date_of_birth" id="date_of_birth" class="form-input" value="{{ g.user.date_of_birth or '' }}"></div>
                    <div><label for="gender" class="form-label">Gender</label><select name="gender" id="gender" class="form-input"><option value="">Select...</option><option value="Male" {% if g.user.gender == 'Male' %}selected{% endif %}>Male</option><option value="Female" {% if g.user.gender == 'Female' %}selected{% endif %}>Female</option><option value="Other" {% if g.user.gender == 'Other' %}selected{% endif %}>Other</option></select></div>
                    <div><label for="designation" class="form-label">Designation / Title</label><input type="text" name="designation" id="designation" class="form-input" value="{{ g.user.designation or '' }}" placeholder="e.g., Data Entry Operator"></div>
                </div>
            </div>

            <div class="border-t pt-6">
                <h3 class="text-lg font-medium text-gray-900">Bank Account Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                    <div><label for="holder_name" class="form-label">Account Holder's Name</label><input type="text" name="holder_name" id="holder_name" class="form-input" value="{{ bank_data.get('holder_name', '') }}"></div>
                    <div><label for="bank_name" class="form-label">Bank Name</label><input type="text" name="bank_name" id="bank_name" class="form-input" value="{{ bank_data.get('bank_name', '') }}"></div>
                    <div><label for="account_number" class="form-label">Account Number</label><input type="text" name="account_number" id="account_number" class="form-input" value="{{ bank_data.get('account_number', '') }}"></div>
                    <div><label for="ifsc_code" class="form-label">IFSC Code</label><input type="text" name="ifsc_code" id="ifsc_code" class="form-input" value="{{ bank_data.get('ifsc_code', '') }}"></div>
                </div>
            </div>
            
            <div class="flex justify-end pt-4">
                 <button type="submit" class="btn-primary" style="width: auto;">Save Changes</button>
            </div>
        </form>
    </div>
</main>
{% endblock %}