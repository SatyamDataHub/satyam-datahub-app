{% extends "layout.html" %}
{% block content %}
<main class="mx-auto max-w-7xl py-6 sm:px-6 lg:px-8">
    <div class="mb-4">
        <a href="{{ url_for('admin_dashboard') }}" class="text-sm font-medium text-indigo-600 hover:text-indigo-500">&larr; Back to Dashboard</a>
        <h1 class="text-3xl font-bold text-gray-900 mt-2">Reviewing Project: {{ project.project_name }}</h1>
    </div>
    <div class="mb-6 bg-indigo-50 p-4 rounded-lg border border-indigo-200">
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
            <div><p class="text-sm font-semibold">Project</p><p>{{ project.project_name }}</p></div>
            <div><p class="text-sm font-semibold">Employee</p><p>{{ project.employee_name }}</p></div>
            <div><p class="text-sm font-semibold">Employee ID</p><p>{{ project.emp_id }}</p></div>
            <div><p class="text-sm font-semibold">Cost</p><p>₹{{ "%.2f"|format(project.cost) }}</p></div>
            <div><p class="text-sm font-semibold">Submitted</p><p>{{ project.assigned_date.strftime('%Y-%m-%d') }}</p></div>
        </div>
    </div>
    <div class="space-y-6">
    {% for task in tasks %}
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 bg-white p-4 rounded-lg shadow-md data-entry-grid">
            <div class="p-2 border rounded-md data-entry-image-viewer">
                <h3 class="font-bold text-gray-700 mb-2">TASK-{{ "%07d"|format(task.id) }} ({{ task.filename }})</h3>
                <img src="{{ url_for('uploaded_file', filename=task.filename) }}" alt="Task image" class="w-full h-auto rounded-md" />
            </div>
            <div>
                <form action="{{ url_for('update_task_data', task_id=task.id) }}" method="POST" class="space-y-3">
                    <div class="grid grid-cols-2 gap-3">
                        <div><label class="form-label-sm">Name</label><input type="text" name="name" value="{{ task.data.get('name', '') }}" class="form-input-sm"></div>
                        <div><label class="form-label-sm">Age</label><input type="text" name="age" value="{{ task.data.get('age', '') }}" class="form-input-sm"></div>
                        <div><label class="form-label-sm">Mobile</label><input type="text" name="mobileNumber" value="{{ task.data.get('mobileNumber', '') }}" class="form-input-sm"></div>
                        <div><label class="form-label-sm">Sex</label><input type="text" name="sex" value="{{ task.data.get('sex', '') }}" class="form-input-sm"></div>
                    </div>
                    <div><label class="form-label-sm">Address</label><textarea name="address" rows="2" class="form-input-sm">{{ task.data.get('address', '') }}</textarea></div>
                    <div><label class="form-label-sm">Receipt #</label><input type="text" name="receiptNumber" value="{{ task.data.get('receiptNumber', '') }}" class="form-input-sm"></div>
                    <button type="submit" class="btn-primary w-full mt-2">Update Task Data</button>
                </form>
            </div>
        </div>
    {% endfor %}
    </div>
    <div class="mt-8 bg-white p-6 rounded-lg shadow-md flex justify-end space-x-4">
        <form action="{{ url_for('finalize_project', project_id=project.id) }}" method="POST"><input type="hidden" name="action" value="reject"><button type="submit" class="btn-danger">Reject Project</button></form>
        <form action="{{ url_for('finalize_project', project_id=project.id) }}" method="POST"><input type="hidden" name="action" value="approve"><button type="submit" class="btn-secondary">Approve Project & Pay ₹{{ "%.2f"|format(project.cost) }}</button></form>
    </div>
</main>
{% endblock %}